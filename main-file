#rodar na primeira vez
from datetime import date, datetime
remedios={}


########################## ARQUIVO FUN√á√ïES  ################################################################### 

sugestao = 6
sim = ['SIM', 'S']
nao = ['N√ÉO', 'NAO', 'N']
sim_ou_nao = sim+nao

def add_info_remedio(remedios):
  remedio = input('Qual o nome do rem√©dio?\n‚ñ∫ ').upper().strip()
  while remedio.replace(" ","").isnumeric() or remedio.strip()=='':
    remedio = input('      Por favor, digite um nome v√°lido\n      Qual o nome do rem√©dio?\n      ‚ñ∫ ').upper().strip() 
  
  intervalo = input('Qual o intervalo entre as dosagens? (Ex: 8h)\n‚ñ∫ ').upper().strip().replace(" ","")
  while intervalo.isalpha() == True or ('H' not in intervalo and intervalo.isnumeric()==False) or len(intervalo)>7:
    intervalo = input('      Por favor, digite no formato "8h")\n      Qual o intervalo entre as dosagens?\n      ‚ñ∫ ').upper().strip().replace(" ","")
  intervalo = int(intervalo.split('H')[0])
  if intervalo > 12:
    print('Como o intervalo escolhido √© maior que 12 horas, vamos assumir que voc√™ ir√° tomar 1 vez ao dia')
    intervalo = 24

  quantidade = input('Quantos comprimidos voc√™ deve tomar por vez\n‚ñ∫ ').strip()
  while quantidade.isnumeric()==False:
    quantidade = input('      Por favor, use apenas n√∫meros, n√£o letra. (Ex: 1)\n      Quantos comprimidos voc√™ deve tomar por vez?\n      ‚ñ∫ ').strip()
    
  dias = input('Durante quantos dias voc√™ deve tomar essa medica√ß√£o?\n‚ñ∫ ').strip()
  while dias.isnumeric()==False:
    dias = input('      Por favor, use apenas n√∫meros, n√£o letra. (Ex: 7)\n      Durante quantos dias voc√™ deve tomar essa medica√ß√£o?\n      ‚ñ∫ ').strip()
 
  quest_sugest = input('Nossa sugest√£o √© iniciar o medicamento √†s {}h.\nAceita o hor√°rio sugerido?\n‚ñ∫ '.format(sugestao)).upper().strip()
  while quest_sugest not in sim_ou_nao:
    quest_sugest = input('      Por favor, responda apenas com "Sim" ou "N√£o"\n      Aceita o hor√°rio sugerido?\n      ‚ñ∫  ').upper().strip()
  if quest_sugest in sim:
    hora_remedio = str(sugestao)
  elif quest_sugest in nao:
    quest_agora = input('Ok, ent√£o tudo bem a gente come√ßar agora?\n‚ñ∫  ').upper().strip()
    while quest_agora not in sim_ou_nao:
      quest_agora = input('      Por favor, responda apenas com "Sim" ou "N√£o"\n      Tudo bem a gente come√ßar agora?\n      ‚ñ∫  ').upper().strip()
    if quest_agora in sim:
      hora_remedio = str(datetime.datetime.now().hour)
    elif quest_agora in nao:
      hora_remedio = input('Tudo bem. Escolha o hor√°rio que quer iniciar a medica√ß√£o (Ex: 16h)\n‚ñ∫ ').strip().upper().strip().replace(" ","")
      while hora_remedio.isalpha() == True or 'H' not in hora_remedio or len(hora_remedio)>7:
        hora_remedio = input('      Por favor, digite no formato "8h")\n      Escolha o hor√°rio que quer iniciar a medica√ß√£o\n      ‚ñ∫ ').upper().strip().replace(" ","")
      hora_remedio = int(hora_remedio.split('H')[0])

  remedios[remedio]= {
  "intervalo": intervalo,
  "quantidade": int(quantidade),
  "dias": int(dias),
  "hora_remedio": int(hora_remedio)
}
  return remedio
  
def definir_alarmes(remedios):
  por_dia= int(24/remedios[remedio]['intervalo'])
  alarmes = []
  hora_alarmes = remedios[remedio]['hora_remedio']
  for i in range(por_dia):
    if hora_alarmes < 24:
      alarmes.append(hora_alarmes)
    elif hora_alarmes >= 24:
      alarmes.append(hora_alarmes-24)
    hora_alarmes+=remedios[remedio]['intervalo']
  remedios[remedio]['alarmes'] = alarmes
  return alarmes

def definir_inicio_fim_remedio(remedios):
  data_atual = date.today()
  data_final = date.fromordinal(data_atual.toordinal()+remedios[remedio]['dias'])
  hora_final = alarmes[-1]
  remedios[remedio]['data_inicio'] = data_atual
  remedios[remedio]['data_final'] = data_final
  remedios[remedio]['hora_final'] = hora_final


############################################################################################



while True:
  remedio = add_info_remedio(remedios)
  alarmes = definir_alarmes(remedios)
  definir_inicio_fim_remedio(remedios)
  quest_break = input('Voc√™ vai tomar mais rem√©dios? ').upper().strip()
  while quest_break not in sim_ou_nao:
    quest_break = input('Por favor, responda apenas com "Sim" ou "N√£o"\n Voc√™ vai tomar mais rem√©dios? ').upper()
  if quest_break in sim:
    sugestao+=1
  elif quest_break in nao:
    print("""
          
          ‚ñº ‚ñº ‚ñº ‚ñº ‚ñº ‚ñº ‚ñº ‚ñº ‚ñº ‚ñº ‚ñº ‚ñº ‚ñº ‚ñº ‚ñº ‚ñº ‚ñº ‚ñº
          
""")
    for remedio, info in remedios.items():
      print('üíä', end=' ')
      print('\033[1;43m'+remedio+'\033[0;0m')
      plural=''
      if remedios[remedio]['quantidade']>1:
        plural='s'
      print('{} comprimido{} de {} em {} horas por {} dias'.format(remedios[remedio]['quantidade'],plural,remedios[remedio]['intervalo'], remedios[remedio]['intervalo'],remedios[remedio]['dias']))
      print('Voc√™ vai iniciar a medica√ß√£o em {}/{}/{} √†s {}h. \nE deve tomar a √∫ltima dose em {}/{}/{} √†s {}h'.format(remedios[remedio]['data_inicio'].day, remedios[remedio]['data_inicio'].month, remedios[remedio]['data_inicio'].year, remedios[remedio]['hora_remedio'],remedios[remedio]['data_final'].day, remedios[remedio]['data_final'].month, remedios[remedio]['data_final'].year, remedios[remedio]['hora_final']))
      print('Hor√°rio do medicamento:', end=' ')
      for i in remedios[remedio]['alarmes']:
        print(i, end='h | ')
      print('\nTotal de comprimidos: {}'.format(remedios[remedio]['quantidade']*len(remedios[remedio]['alarmes'])*remedios[remedio]['dias']))
    break
    
